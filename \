use crate::application::Application;
use eframe::egui;

impl Application {
    pub fn settings_ui(&mut self, ctx: &egui::Context) {
        let mut font_size = self.settings.font_size;
        egui::CentralPanel::default().show(ctx, |ui| {
            self.menu_bar(ctx, ui);
            ui.vertical(|ui| {
                ui.horizontal(|ui| {
                    ui.heading("Font Size");
                    let slider = ui.add(
                        egui::Slider::new(&mut font_size, 10.0..=30.0)
                            .integer()
                            .show_value(false),
                    );
                    if slider.drag_stopped() {
                        self.settings.font_size = font_size;
                    }
                });
                ui.horizontal(|ui| {
                    ui.heading("Dark Mode");
                    let dark_mode = self.settings.dark_mode;
                    ui.toggle_value(&mut self.settings.dark_mode, dark_mode.to_string());
                });
                ui.horizontal(|ui| {
                    ui.heading("Target Grade");
                    let grade_button = ui.button(self.progress_tracker.target_grade.to_string());
                    let grade_popup_id = ui.make_persistent_id("Grade popup");
                    egui::containers::popup::popup_below_widget(
                        ui,
                        grade_popup_id,
                        &grade_button,
                        egui::containers::popup::PopupCloseBehavior::CloseOnClickOutside,
                        |ui| {
                            let save_button = ui
                                .label("3")
                                .on_hover_cursor(egui::CursorIcon::PointingHand);
                            if save_button.hovered() {
                                save_button.clone().highlight();
                            }
                            if save_button.clicked() {
                                self.progress_tracker.target_grade = 3;
                                self.progress_tracker.update();
                                ui.memory_mut(|memory| {
                                    memory.close_popup();
                                });
                            }
                            let save_button = ui
                                .label("4")
                                .on_hover_cursor(egui::CursorIcon::PointingHand);
                            if save_button.hovered() {
                                save_button.clone().highlight();
                            }
                            if save_button.clicked() {
                                self.progress_tracker.target_grade = 4;
                                self.progress_tracker.update();
                                ui.memory_mut(|memory| {
                                    memory.close_popup();
                                });
                            }
                            let save_button = ui
                                .label("5")
                                .on_hover_cursor(egui::CursorIcon::PointingHand);
                            if save_button.hovered() {
                                save_button.clone().highlight();
                            }
                            if save_button.clicked() {
                                self.progress_tracker.target_grade = 5;
                                self.progress_tracker.update();
                                ui.memory_mut(|memory| {
                                    memory.close_popup();
                                });
                            }
                        },
                    );

                    if grade_button.clicked() {
                        ui.memory_mut(|memory| {
                            memory.toggle_popup(grade_popup_id);
                        });
                    }
                });
                ui.horizontal(|ui| {
                    ui.heading("Target Grade");
                    let grade_button = ui.button(self.progress_tracker.target_grade.to_string());
                    let grade_popup_id = ui.make_persistent_id("Grade popup");
                    egui::containers::popup::popup_below_widget(
                        ui,
                        grade_popup_id,
                        &grade_button,
                        egui::containers::popup::PopupCloseBehavior::CloseOnClickOutside,
                        |ui| {
                            let save_button = ui
                                .label("3")
                                .on_hover_cursor(egui::CursorIcon::PointingHand);
                            if save_button.hovered() {
                                save_button.clone().highlight();
                            }
                            if save_button.clicked() {
                                self.progress_tracker.target_grade = 3;
                                self.progress_tracker.update();
                                ui.memory_mut(|memory| {
                                    memory.close_popup();
                                });
                            }
                            let save_button = ui
                                .label("4")
                                .on_hover_cursor(egui::CursorIcon::PointingHand);
                            if save_button.hovered() {
                                save_button.clone().highlight();
                            }
                            if save_button.clicked() {
                                self.progress_tracker.target_grade = 4;
                                self.progress_tracker.update();
                                ui.memory_mut(|memory| {
                                    memory.close_popup();
                                });
                            }
                            let save_button = ui
                                .label("5")
                                .on_hover_cursor(egui::CursorIcon::PointingHand);
                            if save_button.hovered() {
                                save_button.clone().highlight();
                            }
                            if save_button.clicked() {
                                self.progress_tracker.target_grade = 5;
                                self.progress_tracker.update();
                                ui.memory_mut(|memory| {
                                    memory.close_popup();
                                });
                            }
                        },
                    );

                    if grade_button.clicked() {
                        ui.memory_mut(|memory| {
                            memory.toggle_popup(grade_popup_id);
                        });
                    }
                });
            });
        });
    }
}
